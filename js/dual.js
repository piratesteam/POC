let container,camera,scene,renderer,light,controls,water,sphere,geometry,cube,material,ship,ship2,shootbomb,master_shootbomb,shark,intersects,intersects2,time,delta,moveDistance,rotateAngle,rotation_matrix,loader,waterGeometry,sky,uniforms,parameters,cubeCamera,theta,phi,normal,position,shark2,topCamera,SCREEN_HEIGHT,SCREEN_WIDTH,ASPECT,VIEW_ANGLE,NEAR,FAR,distance,shootbomb2,position2,master_shootbomb2,relativeCameraOffset,cameraOffset,timer,shootbullet=!1,meshArray=[],hit=0,bulletCount=11,frames4=0,frames3=0,frames=0,frames2=0,shootbullet2=!1,bulletCount2=16,meshArray2=[],hit2=0,bulletLeft=!0,bulletLeft2=!0,$elie=$("#box"),degree=0,bulletover=!1,bullet2over=!1,keyboard=new THREEx.KeyboardState,clock=new THREE.Clock,bGroup2=new THREE.Group,raycaster=new THREE.Raycaster,pivotPoint=new THREE.Object3D,pivotPoint2=new THREE.Object3D,direction=new THREE.Vector3,far=new THREE.Vector3,finalship=new THREE.Group,finalship2=new THREE.Group,box=document.getElementById("box"),game_sound=document.getElementById("game_sound"),missile_sound=document.getElementById("missile_sound"),sea_sound=document.getElementById("sea_sound"),blast_sound=document.getElementById("blast_sound"),hit_sound=document.getElementById("hit_sound");function init(){scene=new THREE.Scene,SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,VIEW_ANGLE=90,ASPECT=SCREEN_WIDTH/SCREEN_HEIGHT,NEAR=.1,FAR=2e4,camera=new THREE.PerspectiveCamera(120,ASPECT,NEAR,FAR),scene.add(camera),topCamera=new THREE.PerspectiveCamera(120,ASPECT,NEAR,FAR),scene.add(topCamera),(renderer=Detector.webgl?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer).setSize(SCREEN_WIDTH,SCREEN_HEIGHT),(container=document.getElementById("container")).appendChild(renderer.domElement),THREEx.WindowResize(renderer,topCamera),THREEx.WindowResize(renderer,camera),light=new THREE.HemisphereLight(16777147,526368,1),scene.add(light),waterGeometry=new THREE.PlaneBufferGeometry(1e4,1e4),(water=new THREE.Water(waterGeometry,{textureWidth:512,textureHeight:512,waterNormals:(new THREE.TextureLoader).load("images/waternormals.jpg",function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping}),alpha:1,sunDirection:light.position.clone().normalize(),sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==scene.fog})).rotation.x=-Math.PI/2,scene.add(water),sky=new THREE.Sky,(uniforms=sky.material.uniforms).turbidity.value=10,uniforms.rayleigh.value=2,uniforms.luminance.value=1,uniforms.mieCoefficient.value=.005,uniforms.mieDirectionalG.value=.8,parameters={distance:100,inclination:.8,azimuth:-.3},(cubeCamera=new THREE.CubeCamera(.1,1,512)).renderTarget.texture.generateMipmaps=!0,cubeCamera.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.background=cubeCamera.renderTarget,(loader=new THREE.GLTFLoader).load("models/bomb/scene.gltf",function(e){e.scene.traverse(function(e){e.rotateOnAxis(new THREE.Vector3(0,1,0),-Math.PI/2),(master_shootbomb=new THREE.Group).add(e),scene.add(master_shootbomb)})}),(loader=new THREE.GLTFLoader).load("models/bomb/scene.gltf",function(e){e.scene.traverse(function(e){e.rotateOnAxis(new THREE.Vector3(0,1,0),Math.PI/2),(master_shootbomb2=new THREE.Group).add(e),scene.add(master_shootbomb2)})}),(loader=new THREE.GLTFLoader).load("models/shark/scene.gltf",function(e){e.scene.scale.x=5,e.scene.scale.y=5,e.scene.scale.z=5,e.scene.position.set(-40,1.5,0),shark=e.scene,pivotPoint.add(shark),scene.add(pivotPoint)}),(loader=new THREE.GLTFLoader).load("models/shark2/scene.gltf",function(e){e.scene.scale.x=.2,e.scene.scale.y=.2,e.scene.scale.z=.2,e.scene.position.set(40,1.5,0),(shark2=e.scene).rotation.x=-6,pivotPoint2.add(shark2),scene.add(pivotPoint2)}),loader=new THREE.TextureLoader,normal=loader.load("./models/ship/Galleon.jpg"),(loader=new THREE.TDSLoader).setResourcePath("Objects/"),loader.load("models/ship/Galleon.3ds",function(e){e.traverse(function(e){e.isMesh&&(meshArray2.push(e),e.material.normalMap=normal)}),(ship=e).name=localStorage.player1,ship.rotation.x=-Math.PI/2,ship.rotation.z=-Math.PI,finalship.add(ship),finalship.add(pivotPoint)}),loader=new THREE.TextureLoader,normal=loader.load("./models/ship/Galleon.jpg"),(loader=new THREE.TDSLoader).setResourcePath("Objects/"),loader.load("models/ship/Galleon.3ds",function(e){e.traverse(function(e){e.isMesh&&(meshArray.push(e),e.material.normalMap=normal)}),(ship2=e).name=localStorage.player2,ship2.rotation.x=-Math.PI/2,ship2.rotation.z=-Math.PI,bGroup2.add(ship2),finalship2.add(bGroup2),finalship2.add(pivotPoint2),finalship2.position.set(60,0,0)}),scene.add(finalship),scene.add(finalship2),renderer.setSize(window.innerWidth,window.innerHeight),renderer.autoClear=!1}function rotate(){$elie.css({WebkitTransform:"rotate("+degree+"deg)"}),$elie.css({"-moz-transform":"rotate("+degree+"deg)"}),timer=setTimeout(function(){++degree,rotate()},1)}function onKeyDown(e){keyboard.pressed("D")&&(rotate(),setTimeout(()=>{clearTimeout(timer)},1)),keyboard.pressed("A")&&(rotate(),setTimeout(()=>{clearTimeout(timer)},1)),32==e.keyCode&&(missile_sound.play(),shootbullet&&setTimeout(()=>{shootbullet=!1,scene.remove(shootbomb)},1e3),0==shootbullet&&bulletLeft&&($("#"+bulletCount).hide(),16==++bulletCount&&(bulletover=!0,bulletCount=69,bulletLeft=!1),shootbomb=master_shootbomb.clone(),scene.add(shootbomb),shootbomb.scale.x=5,shootbomb.scale.y=5,shootbomb.scale.z=5,shootbomb.position.x=finalship.position.x,shootbomb.position.z=finalship.position.z,shootbomb.position.y=4,0==finalship.rotation.z?shootbomb.rotation.y=finalship.rotation.y:shootbomb.rotation.y=-finalship.rotation.y+Math.PI,position=new THREE.Vector3(finalship.position.x,finalship.position.y,finalship.position.z),shootbullet=!0)),96==e.keyCode&&(missile_sound.play(),shootbullet2&&setTimeout(()=>{shootbullet2=!1,scene.remove(shootbomb)},1e3),0==shootbullet2&&bulletLeft2&&($("#"+bulletCount2).hide(),21==++bulletCount2&&(bullet2over=!0,bulletCount2=69,bulletLeft2=!1),shootbomb2=master_shootbomb2.clone(),scene.add(shootbomb2),shootbomb2.scale.x=5,shootbomb2.scale.y=5,shootbomb2.scale.z=5,shootbomb2.position.x=finalship2.position.x,shootbomb2.position.z=finalship2.position.z,shootbomb2.position.y=4,0==finalship2.rotation.z?shootbomb2.rotation.y=finalship2.rotation.y:shootbomb2.rotation.y=-finalship2.rotation.y+Math.PI,position2=new THREE.Vector3(finalship2.position.x,finalship2.position.y,finalship2.position.z),shootbullet2=!0))}function update(){delta=clock.getDelta(),moveDistance=8*delta,rotateAngle=Math.PI/2*delta/8,keyboard.pressed("W")&&(sea_sound.play(),finalship.translateZ(1.2*-moveDistance)),keyboard.pressed("S")&&(sea_sound.play(),finalship.translateZ(1.2*moveDistance)),rotation_matrix=(new THREE.Matrix4).identity(),keyboard.pressed("A")&&(sea_sound.play(),finalship.rotateOnAxis(new THREE.Vector3(0,1,0),rotateAngle)),keyboard.pressed("D")&&(sea_sound.play(),finalship.rotateOnAxis(new THREE.Vector3(0,1,0),-rotateAngle)),keyboard.pressed("up")&&(sea_sound.play(),finalship2.translateZ(1.2*-moveDistance)),keyboard.pressed("down")&&(sea_sound.play(),finalship2.translateZ(1.2*moveDistance)),rotation_matrix=(new THREE.Matrix4).identity(),keyboard.pressed("left")&&(sea_sound.play(),finalship2.rotateOnAxis(new THREE.Vector3(0,1,0),rotateAngle)),keyboard.pressed("right")&&(sea_sound.play(),finalship2.rotateOnAxis(new THREE.Vector3(0,1,0),-rotateAngle)),relativeCameraOffset=new THREE.Vector3(30,10,90),cameraOffset=relativeCameraOffset.applyMatrix4(finalship.matrixWorld),camera.position.x=cameraOffset.x,camera.position.y=cameraOffset.y,camera.position.z=cameraOffset.z,camera.lookAt(finalship.position);var e=new THREE.Vector3(30,10,90).applyMatrix4(finalship2.matrixWorld);topCamera.position.x=e.x,topCamera.position.y=e.y,topCamera.position.z=e.z,topCamera.lookAt(finalship2.position),SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,camera.aspect=.5*SCREEN_WIDTH/SCREEN_HEIGHT,topCamera.aspect=.5*SCREEN_WIDTH/SCREEN_HEIGHT,camera.updateProjectionMatrix(),topCamera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setViewport(2,2,SCREEN_WIDTH,SCREEN_HEIGHT),renderer.clear(),renderer.setViewport(1,1,.5*SCREEN_WIDTH-2,SCREEN_HEIGHT-2),renderer.render(scene,camera),renderer.clearDepth(),renderer.setViewport(.5*SCREEN_WIDTH+1,1,.5*SCREEN_WIDTH-2,SCREEN_HEIGHT-2),renderer.render(scene,topCamera),shootbomb&&shootbomb.translateX(12*moveDistance),shootbomb2&&shootbomb2.translateX(12*-moveDistance),position&&shootbomb&&(raycaster.set(shootbomb.position,direction.subVectors(position,shootbomb.position).normalize()),raycaster.far=far.subVectors(position,shootbomb.position).length(),(intersects=raycaster.intersectObjects(meshArray)).length>0&&(hit++,hit_sound.play(),setTimeout(()=>{shootbullet=!1,scene.remove(shootbomb)},1e3),shootbomb.position.set(position))),position2&&shootbomb2&&(raycaster.set(shootbomb2.position,direction.subVectors(position2,shootbomb2.position).normalize()),raycaster.far=far.subVectors(position2,shootbomb2.position).length(),(intersects2=raycaster.intersectObjects(meshArray2)).length>0&&(hit2++,hit_sound.play(),setTimeout(()=>{shootbullet2=!1,scene.remove(shootbomb2)},1e3),shootbomb2.position.set(position2))),(distance=finalship.position.distanceTo(finalship2.position))<30&&(finalship.position.x=finalship.position.x-25,finalship2.position.x=finalship2.position.x+25),distance<150&&Math.floor(camera.position.z)>60&&(camera.position.z-=.5),distance>150&&Math.floor(camera.position.z)<120&&(camera.position.z+=.5),parameters.distance=500,Math.floor(parameters.inclination)<.5&&(parameters.inclination+=.001),Math.floor(parameters.inclination)>.5&&(parameters.inclination-=.001),parameters.azimuth+=5e-4,theta=Math.PI*(parameters.inclination-.5),phi=2*Math.PI*(parameters.azimuth-.5),light.position.x=parameters.distance*Math.cos(phi),light.position.y=parameters.distance*Math.sin(phi)*Math.sin(theta),light.position.z=parameters.distance*Math.sin(phi)*Math.cos(theta),sky.material.uniforms.sunPosition.value=light.position.copy(light.position),water.material.uniforms.sunDirection.value.copy(light.position).normalize(),cubeCamera.update(renderer,sky)}function render(){pivotPoint.position.set(finalship.position.x,finalship.position.y,finalship.position.z),pivotPoint.rotation.y+=.01,pivotPoint2.position.set(finalship2.position.x,finalship2.position.y,finalship2.position.z),pivotPoint2.rotation.y+=.01,bulletover&&bullet2over&&(bulletover=!1,bullet2over=!1,bulletCount=11,bulletCount2=16,bulletLeft=!0,bulletLeft2=!0,$("#11").show(),$("#12").show(),$("#13").show(),$("#14").show(),$("#15").show(),$("#16").show(),$("#17").show(),$("#18").show(),$("#19").show(),$("#20").show()),1==hit&&($("#4").hide(),(frames+=1)<20?ship2.rotation.y+=.005:frames>=20&&frames<40?ship2.rotation.y-=.005:frames>=40&&frames<80?ship2.rotation.y-=.005:frames>=80&&frames<120&&(ship2.rotation.y+=.005)),2==hit&&($("#5").hide(),(frames2+=1)<40?ship2.rotation.y+=.005:frames2>=40&&frames2<60?ship2.rotation.y-=.005:frames2>=60&&frames2<100?ship2.rotation.y-=.005:frames2>=100&&frames2<140&&(ship2.rotation.y+=.005)),3==hit&&(blast_sound.play(),bulletLeft2=!1,localStorage.playerwin=ship.name,$("#6").hide(),ship2.rotation.y+=.01,setTimeout(function(){location.replace("scoreboard.html")},5e3)),1==hit2&&($("#1").hide(),(frames3+=1)<20?ship.rotation.y+=.005:frames3>=20&&frames3<40?ship.rotation.y-=.005:frames3>=40&&frames3<80?ship.rotation.y-=.005:frames3>=80&&frames3<120&&(ship.rotation.y+=.005)),2==hit2&&($("#2").hide(),(frames4+=1)<40?ship.rotation.y+=.005:frames4>=40&&frames4<60?ship.rotation.y-=.005:frames4>=60&&frames4<100?ship.rotation.y-=.005:frames4>=100&&frames4<140&&(ship.rotation.y+=.005)),3==hit2&&(bulletLeft=!1,blast_sound.play(),localStorage.playerwin=ship2.name,$("#3").hide(),ship.rotation.y+=.01,setTimeout(function(){location.replace("scoreboard.html")},5e3)),time=.001*performance.now(),camera.position.y=Math.sin(2*time)+1+10,water.material.uniforms.time.value+=1/60,renderer.render(scene,camera)}function animate(){requestAnimationFrame(animate),render(),update()}init(),animate(),window.addEventListener("keydown",onKeyDown,!1);